/*! qg.swe.charts - v0.0.1 - 2014-04-22
* https://github.com/qld-gov-au/qg.swe.charts
* Copyright (c) 2014 The State of Queensland; Licensed BSD (3-Clause) */
!function(a,b){"use strict";b.swe.loaded("data",function(c){c=a.extend({title:"Data",headings:[],rowHeadings:!0,group:"col",formats:{},type:"bar",legend:!0,supplementary:[],colours:["#313695","#4575B4","#74ADD1","#ABD9E9","#FEE090","#FDAE61","#F46D43","#D73027","#A50026"],delimiter:", "},c);var d={};if("string"==typeof c.colours)switch(c.colours.toLowerCase()){case"rag":c.colours=["#d80000","#ffb400","#007c00"];break;case"priority":c.colours=["#F46D43","#FDAE61","#313695","#ABD9E9"];break;case"initiatives":c.colours=["#313695"]}d.text=function(d){var e=a(document.getElementById(c.container));return 0===e.length?void a.debug("Element not found for data",c.container):(d.result.records.length>0&&e.html(a.map(d.result.records,function(d){return d=a.map(d,function(a,d){return b.swe.template.format(a,c.formats[d])}).join(c.delimiter)}).join("\n")),void e.trigger("x-height-change"))},d.ul=function(d){var e=a(document.getElementById(c.container));return 0===e.length?void a.debug("Element not found for data",c.container):(d.result.records.length>0&&e.html('<ul class="data">'+a.map(d.result.records,function(d){return d=a.map(d,function(a,d){return b.swe.template.format(a,c.formats[d])}).join(c.delimiter),"<li>"+b.swe.template.clean(d)+"</li>"}).join("\n")+"</ul>"),void e.trigger("x-height-change"))},d.dl=function(d){var e=a(document.getElementById(c.container));if(0===e.length)return void a.debug("Element not found for chart",c.container);var f="",g=0;e.html('<p class="total-search-count">Displaying '+d.result.records.length+" search results</p>"+a.map(d.result.records,function(d,e){return g++,d=a.map(c.headings,function(g,h){return f=a.inArray(g,c.supplementary)>-1?' class="supplementary"':"",0!==h?"<dt"+f+">"+c.headings[h]+"</dt><dd"+f+">"+b.swe.template.format(d[g],c.formats[g],{abbr:"both"})+"</dd>":void(e="<h3>"+b.swe.template.format(d[g],c.formats[g],{abbr:"both"})+"</h3>")}),'<div id="rs'+g+'">'+e+"<dl>"+d.join("")+"</dl></div>"+(c.supplementary.length>0?'<a class="more" href="#rs'+g+'">Show moreâ€¦</a>':"")}).join("")),a("a.more",e).butterfly(),e.trigger("x-height-change")},d.chart=function(d){var e,f,g,h,i,j,k,l,m,n,o,p=a(document.getElementById(c.container)),q=!0;if(0===p.length)return void a.debug("Element not found for chart",c.container);switch(p.html('<table class="chart"><caption>'+b.swe.template.clean(c.title)+"</caption><thead>"+a.map(c.headings,function(a){return'<th scope="col">'+b.swe.template.clean(a)+"</th>"}).join("")+"</thead><tbody>"+a.map(d.result.records,function(d){var e;return d=a.map(c.headings.slice(0),function(a,f){return e=c.rowHeadings&&0===f?"th":"td","<"+e+("th"===e?' scope="row"':"")+">"+b.swe.template.format(d[a],c.formats[a])+"</"+e+">"}),"<tr"+((q=!q)?' class="even"':"")+">"+d.join("")+"</tr>"}).join("")+"</tbody></table>"),e=p.find("table"),e.wrap('<div class="section"/>').before("<h2>Table</h2>"),e.parent().generateId(c.container+"-table"),g=Math.max(e.height(),250),j=a('<div class="section"><h2>Chart</h2></div>').generateId(c.container+"-chart").prependTo(p),j=a("<div/>").appendTo(j),p.compact({type:"tabbed",variableHeight:!0,rememberStateInCookie:!1}),f=j.width(),j.height(g),h=a("tbody tr",e).length,i=a("tbody tr",e).eq(0).find("td").length,m={},n={tickDecimals:0,max:1},d=a.map(a("tbody tr",e),function(b){return[a.map(a("th, td",b),function(b){b=a(b);var c=b.text();return b.is("td")&&(c=parseFloat(c.replace(/[^0-9\.]+/g,""))),c})]}),c.type){case"line":"row"!==c.group?(d=a.map(d,function(b){return{label:b.shift(),data:a.map(b,function(a,b){return a>n.max&&(n.max=a),[[b,a]]})}}),m={tickColor:"#EFEDEE",autoscaleMargin:.02,ticks:a.map(a("thead th",e).slice(1),function(b,c){return[[c,a(b).text()]]})}):(d=a.map(d[0].slice(1),function(b,c){return{label:a("thead th",e).eq(c+1).text(),data:a.map(d,function(a,b){var d=a[c+1];return d>n.max&&(n.max=d),[[b,d]]})}}),m={tickColor:"#EFEDEE",labelWidth:10,autoscaleMargin:.02,ticks:a.map(a("tbody th",e),function(b,c){return[[c,a(b).text()]]})}),k={lines:{show:!0,lineWidth:1},points:{show:!1}},o={show:!!c.legend},"string"==typeof c.legend&&a(c.legend).length>0&&(o.container=c.legend);break;case"bar":"row"!==c.group?(d=a.map(d,function(b,c){return{label:b.shift(),data:a.map(b,function(a,b){return a>n.max&&(n.max=a),[[c+b*(h+1),a]]})}}),m={tickColor:"#EFEDEE",autoscaleMargin:.02,ticks:a.map(a("thead th",e).slice(1),function(b,c){return[[Math.floor(h/2)+c*(h+1),a(b).text()]]})}):(d=a.map(d[0].slice(1),function(b,c){return{label:a("thead th",e).eq(c+1).text(),data:a.map(d,function(a,b){var d=a[c+1];return d>n.max&&(n.max=d),[[c+b*(i+1),d]]})}}),m={tickColor:"#EFEDEE",labelWidth:10,autoscaleMargin:.02,ticks:a.map(a("tbody th",e),function(b,c){return[[Math.floor(i/2)+c*(i+1),a(b).text()]]})}),k={bars:{show:!0,barWidth:.75,align:"center",fill:1}},o={show:!!c.legend},"string"==typeof c.legend&&a(c.legend).length>0&&(o.container=c.legend);break;case"pie":d=a.map(d,function(a){return{label:a.shift(),data:a}}),k={pie:{show:!0,radius:.75,label:{show:!0,radius:.85,formatter:function(a,b){return Math.round(b.percent)+"%"},background:{color:"transparent"}}}},l={hoverable:!0,clickable:!0},o=c.legend?{show:!0,labelFormatter:function(a,b){return 0===b.percent?null:a+" ("+Math.round(b.percent)+"%)"},backgroundColor:"transparent"}:{show:!1}}n.max+=n.max/10,a.plot(j,d,{series:k,grid:l,colors:c.colours,xaxis:m,yaxis:n,legend:o}),"pie"===c.type&&!function(){var b,c,d=a(".pieLabel",j);if(d.length>1)for(var e=0;e<d.length;e++)b=d.eq(e),c=d.eq(e-1),b.offset().top+b.height()<c.offset().top||b.offset().top>c.offset().top+c.height()||b.offset().left>c.offset().left+c.width()||b.offset().left+b.width()<c.offset().left||b.css("top",c.position().top-(b.height()+1));else d.addClass("pieLabel100")}(),p.trigger("x-height-change")},d.pie=d.chart,d.line=d.chart,d.bar=d.chart,"function"!=typeof d[c.type]&&(c.type="ul"),b.data.get("data.qld.gov.au",c.sql,d[c.type])})}(jQuery,qg);